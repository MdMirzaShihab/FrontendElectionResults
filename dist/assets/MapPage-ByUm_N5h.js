import{j as v,c as Ft}from"./index-C_gzxXLR.js";import{r as z,u as Ot}from"./vendor-react-D5zly3OG.js";import{u as Yt,a as Xt}from"./useAutoRefresh-C5B4cXPu.js";import{u as qt}from"./useSimulation-DNYEKk6A.js";import{g as Ut,f as Et,a as wt,b as Wt}from"./formatters-DXobJT5u.js";import{C as Mn}from"./Card-Ce4z5HAh.js";import{S as Zt}from"./Select-COX7ggO_.js";import{a as et}from"./Skeleton-BlVrmxxX.js";import{L as Jt}from"./LastUpdatedIndicator-M3ggrZ6i.js";import"./vendor-charts-CASEHI2m.js";import"./vendor-state-CPk78qbZ.js";import"./vendor-icons-B72874lV.js";function Kt(){const{mapData:n,lastUpdated:t,isLoading:i,error:e,fetchMapData:r}=Yt(),s=z.useCallback(()=>r(),[r]);return Xt(s,{interval:3e4}),qt(z.useCallback(()=>r(),[r])),{mapData:n,lastUpdated:t,isLoading:i,error:e,refresh:s}}function Qt(n){return z.useMemo(()=>!n||n.length===0?[]:Ut().map(i=>{const e=n.filter(f=>f.districtId===i.id),r=e.reduce((f,c)=>f+c.totalVotes,0),s=e.length>0?Math.round(e.reduce((f,c)=>f+c.completionPercent,0)/e.length):0,l={},p={};for(const f of e)f.leadingPartyId&&(l[f.leadingPartyId]=(l[f.leadingPartyId]||0)+1,p[f.leadingPartyId]=(p[f.leadingPartyId]||0)+f.totalVotes);let g=null,h=0,o=0;for(const[f,c]of Object.entries(l)){const S=p[f]||0;(c>h||c===h&&S>o)&&(h=c,o=S,g=f)}const a=g?e.find(f=>f.leadingPartyId===g):null,u=Object.entries(l).sort((f,c)=>c[1]-f[1]).map(([f,c])=>`${e.find(m=>m.leadingPartyId===f)?.leadingPartyName||f} × ${c}`);return{districtId:i.id,name:i.name,divisionId:i.divisionId,leadingPartyId:g,leadingPartyColor:a?.leadingPartyColor||"#CCCCCC",leadingPartyName:a?.leadingPartyName||"None",seatCount:e.length,totalVotes:r,completionPercent:s,seatBreakdown:u.join(", "),seats:e}}),[n])}class en{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const i=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const s=i[r],l=t+s,p=Math.abs(t)<Math.abs(s)?t-(l-s):s-(l-t);p&&(i[e++]=p),t=l}return i[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let i=this._n,e,r,s,l=0;if(i>0){for(l=t[--i];i>0&&(e=l,r=t[--i],l=e+r,s=r-(l-e),!s););i>0&&(s<0&&t[i-1]<0||s>0&&t[i-1]>0)&&(r=s*2,e=l+r,r==e-l&&(l=e))}return l}}function*bt(n){for(const t of n)yield*t}function Pt(n){return Array.from(bt(n))}var T=1e-6,D=Math.PI,Y=D/2,it=D/4,q=D*2,X=180/D,B=D/180,V=Math.abs,jt=Math.atan,vn=Math.atan2,G=Math.cos,ne=Math.exp,te=Math.log,H=Math.sin,ee=Math.sign||function(n){return n>0?1:n<0?-1:0},on=Math.sqrt,ie=Math.tan;function re(n){return n>1?0:n<-1?D:Math.acos(n)}function mn(n){return n>1?Y:n<-1?-Y:Math.asin(n)}function W(){}function In(n,t){n&&ot.hasOwnProperty(n.type)&&ot[n.type](n,t)}var rt={Feature:function(n,t){In(n.geometry,t)},FeatureCollection:function(n,t){for(var i=n.features,e=-1,r=i.length;++e<r;)In(i[e].geometry,t)}},ot={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var i=n.coordinates,e=-1,r=i.length;++e<r;)n=i[e],t.point(n[0],n[1],n[2])},LineString:function(n,t){Vn(n.coordinates,t,0)},MultiLineString:function(n,t){for(var i=n.coordinates,e=-1,r=i.length;++e<r;)Vn(i[e],t,0)},Polygon:function(n,t){lt(n.coordinates,t)},MultiPolygon:function(n,t){for(var i=n.coordinates,e=-1,r=i.length;++e<r;)lt(i[e],t)},GeometryCollection:function(n,t){for(var i=n.geometries,e=-1,r=i.length;++e<r;)In(i[e],t)}};function Vn(n,t,i){var e=-1,r=n.length-i,s;for(t.lineStart();++e<r;)s=n[e],t.point(s[0],s[1],s[2]);t.lineEnd()}function lt(n,t){var i=-1,e=n.length;for(t.polygonStart();++i<e;)Vn(n[i],t,1);t.polygonEnd()}function an(n,t){n&&rt.hasOwnProperty(n.type)?rt[n.type](n,t):In(n,t)}function Gn(n){return[vn(n[1],n[0]),mn(n[2])]}function un(n){var t=n[0],i=n[1],e=G(i);return[e*G(t),e*H(t),H(i)]}function Nn(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Cn(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function $n(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function En(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Hn(n){var t=on(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Bn(n,t){function i(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(i.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),i}function Fn(n,t){return[V(n)>D?n+Math.round(-n/q)*q:n,t]}Fn.invert=Fn;function Mt(n,t,i){return(n%=q)?t||i?Bn(st(n),ut(t,i)):st(n):t||i?ut(t,i):Fn}function at(n){return function(t,i){return t+=n,[t>D?t-q:t<-D?t+q:t,i]}}function st(n){var t=at(n);return t.invert=at(-n),t}function ut(n,t){var i=G(n),e=H(n),r=G(t),s=H(t);function l(p,g){var h=G(g),o=G(p)*h,a=H(p)*h,u=H(g),f=u*i+o*e;return[vn(a*r-f*s,o*i-u*e),mn(f*r+a*s)]}return l.invert=function(p,g){var h=G(g),o=G(p)*h,a=H(p)*h,u=H(g),f=u*r-a*s;return[vn(a*r+u*s,o*i+f*e),mn(f*i-o*e)]},l}function oe(n){n=Mt(n[0]*B,n[1]*B,n.length>2?n[2]*B:0);function t(i){return i=n(i[0]*B,i[1]*B),i[0]*=X,i[1]*=X,i}return t.invert=function(i){return i=n.invert(i[0]*B,i[1]*B),i[0]*=X,i[1]*=X,i},t}function le(n,t,i,e,r,s){if(i){var l=G(t),p=H(t),g=e*i;r==null?(r=t+e*q,s=t-g/2):(r=ct(l,r),s=ct(l,s),(e>0?r<s:r>s)&&(r+=e*q));for(var h,o=r;e>0?o>s:o<s;o-=g)h=Gn([l,-p*G(o),-p*H(o)]),n.point(h[0],h[1])}}function ct(n,t){t=un(t),t[0]-=n,Hn(t);var i=re(-t[1]);return((-t[2]<0?-i:i)+q-T)%q}function It(){var n=[],t;return{point:function(i,e,r){t.push([i,e,r])},lineStart:function(){n.push(t=[])},lineEnd:W,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var i=n;return n=[],t=null,i}}}function jn(n,t){return V(n[0]-t[0])<T&&V(n[1]-t[1])<T}function wn(n,t,i,e){this.x=n,this.z=t,this.o=i,this.e=e,this.v=!1,this.n=this.p=null}function Ct(n,t,i,e,r){var s=[],l=[],p,g;if(n.forEach(function(c){if(!((S=c.length-1)<=0)){var S,m=c[0],N=c[S],E;if(jn(m,N)){if(!m[2]&&!N[2]){for(r.lineStart(),p=0;p<S;++p)r.point((m=c[p])[0],m[1]);r.lineEnd();return}N[0]+=2*T}s.push(E=new wn(m,c,null,!0)),l.push(E.o=new wn(m,null,E,!1)),s.push(E=new wn(N,c,null,!1)),l.push(E.o=new wn(N,null,E,!0))}}),!!s.length){for(l.sort(t),ft(s),ft(l),p=0,g=l.length;p<g;++p)l[p].e=i=!i;for(var h=s[0],o,a;;){for(var u=h,f=!0;u.v;)if((u=u.n)===h)return;o=u.z,r.lineStart();do{if(u.v=u.o.v=!0,u.e){if(f)for(p=0,g=o.length;p<g;++p)r.point((a=o[p])[0],a[1]);else e(u.x,u.n.x,1,r);u=u.n}else{if(f)for(o=u.p.z,p=o.length-1;p>=0;--p)r.point((a=o[p])[0],a[1]);else e(u.x,u.p.x,-1,r);u=u.p}u=u.o,o=u.z,f=!f}while(!u.v);r.lineEnd()}}}function ft(n){if(t=n.length){for(var t,i=0,e=n[0],r;++i<t;)e.n=r=n[i],r.p=e,e=r;e.n=r=n[0],r.p=e}}function Tn(n){return V(n[0])<=D?n[0]:ee(n[0])*((V(n[0])+D)%q-D)}function ae(n,t){var i=Tn(t),e=t[1],r=H(e),s=[H(i),-G(i),0],l=0,p=0,g=new en;r===1?e=Y+T:r===-1&&(e=-Y-T);for(var h=0,o=n.length;h<o;++h)if(u=(a=n[h]).length)for(var a,u,f=a[u-1],c=Tn(f),S=f[1]/2+it,m=H(S),N=G(S),E=0;E<u;++E,c=y,m=I,N=R,f=w){var w=a[E],y=Tn(w),M=w[1]/2+it,I=H(M),R=G(M),k=y-c,_=k>=0?1:-1,$=_*k,P=$>D,O=m*I;if(g.add(vn(O*_*H($),N*R+O*G($))),l+=P?k+_*q:k,P^c>=i^y>=i){var A=Cn(un(f),un(w));Hn(A);var L=Cn(s,A);Hn(L);var d=(P^k>=0?-1:1)*mn(L[2]);(e>d||e===d&&(A[0]||A[1]))&&(p+=P^k>=0?1:-1)}}return(l<-T||l<T&&g<-1e-12)^p&1}function Dt(n,t,i,e){return function(r){var s=t(r),l=It(),p=t(l),g=!1,h,o,a,u={point:f,lineStart:S,lineEnd:m,polygonStart:function(){u.point=N,u.lineStart=E,u.lineEnd=w,o=[],h=[]},polygonEnd:function(){u.point=f,u.lineStart=S,u.lineEnd=m,o=Pt(o);var y=ae(h,e);o.length?(g||(r.polygonStart(),g=!0),Ct(o,ue,y,i,r)):y&&(g||(r.polygonStart(),g=!0),r.lineStart(),i(null,null,1,r),r.lineEnd()),g&&(r.polygonEnd(),g=!1),o=h=null},sphere:function(){r.polygonStart(),r.lineStart(),i(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function f(y,M){n(y,M)&&r.point(y,M)}function c(y,M){s.point(y,M)}function S(){u.point=c,s.lineStart()}function m(){u.point=f,s.lineEnd()}function N(y,M){a.push([y,M]),p.point(y,M)}function E(){p.lineStart(),a=[]}function w(){N(a[0][0],a[0][1]),p.lineEnd();var y=p.clean(),M=l.result(),I,R=M.length,k,_,$;if(a.pop(),h.push(a),a=null,!!R){if(y&1){if(_=M[0],(k=_.length-1)>0){for(g||(r.polygonStart(),g=!0),r.lineStart(),I=0;I<k;++I)r.point(($=_[I])[0],$[1]);r.lineEnd()}return}R>1&&y&2&&M.push(M.pop().concat(M.shift())),o.push(M.filter(se))}}return u}}function se(n){return n.length>1}function ue(n,t){return((n=n.x)[0]<0?n[1]-Y-T:Y-n[1])-((t=t.x)[0]<0?t[1]-Y-T:Y-t[1])}const pt=Dt(function(){return!0},ce,pe,[-D,-Y]);function ce(n){var t=NaN,i=NaN,e=NaN,r;return{lineStart:function(){n.lineStart(),r=1},point:function(s,l){var p=s>0?D:-D,g=V(s-t);V(g-D)<T?(n.point(t,i=(i+l)/2>0?Y:-Y),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(p,i),n.point(s,i),r=0):e!==p&&g>=D&&(V(t-e)<T&&(t-=e*T),V(s-p)<T&&(s-=p*T),i=fe(t,i,s,l),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(p,i),r=0),n.point(t=s,i=l),e=p},lineEnd:function(){n.lineEnd(),t=i=NaN},clean:function(){return 2-r}}}function fe(n,t,i,e){var r,s,l=H(n-i);return V(l)>T?jt((H(t)*(s=G(e))*H(i)-H(e)*(r=G(t))*H(n))/(r*s*l)):(t+e)/2}function pe(n,t,i,e){var r;if(n==null)r=i*Y,e.point(-D,r),e.point(0,r),e.point(D,r),e.point(D,0),e.point(D,-r),e.point(0,-r),e.point(-D,-r),e.point(-D,0),e.point(-D,r);else if(V(n[0]-t[0])>T){var s=n[0]<t[0]?D:-D;r=i*s/2,e.point(-s,r),e.point(0,r),e.point(s,r)}else e.point(t[0],t[1])}function de(n){var t=G(n),i=6*B,e=t>0,r=V(t)>T;function s(o,a,u,f){le(f,n,i,u,o,a)}function l(o,a){return G(o)*G(a)>t}function p(o){var a,u,f,c,S;return{lineStart:function(){c=f=!1,S=1},point:function(m,N){var E=[m,N],w,y=l(m,N),M=e?y?0:h(m,N):y?h(m+(m<0?D:-D),N):0;if(!a&&(c=f=y)&&o.lineStart(),y!==f&&(w=g(a,E),(!w||jn(a,w)||jn(E,w))&&(E[2]=1)),y!==f)S=0,y?(o.lineStart(),w=g(E,a),o.point(w[0],w[1])):(w=g(a,E),o.point(w[0],w[1],2),o.lineEnd()),a=w;else if(r&&a&&e^y){var I;!(M&u)&&(I=g(E,a,!0))&&(S=0,e?(o.lineStart(),o.point(I[0][0],I[0][1]),o.point(I[1][0],I[1][1]),o.lineEnd()):(o.point(I[1][0],I[1][1]),o.lineEnd(),o.lineStart(),o.point(I[0][0],I[0][1],3)))}y&&(!a||!jn(a,E))&&o.point(E[0],E[1]),a=E,f=y,u=M},lineEnd:function(){f&&o.lineEnd(),a=null},clean:function(){return S|(c&&f)<<1}}}function g(o,a,u){var f=un(o),c=un(a),S=[1,0,0],m=Cn(f,c),N=Nn(m,m),E=m[0],w=N-E*E;if(!w)return!u&&o;var y=t*N/w,M=-t*E/w,I=Cn(S,m),R=En(S,y),k=En(m,M);$n(R,k);var _=I,$=Nn(R,_),P=Nn(_,_),O=$*$-P*(Nn(R,R)-1);if(!(O<0)){var A=on(O),L=En(_,(-$-A)/P);if($n(L,R),L=Gn(L),!u)return L;var d=o[0],C=a[0],x=o[1],j=a[1],F;C<d&&(F=d,d=C,C=F);var nn=C-d,Z=V(nn-D)<T,tn=Z||nn<T;if(!Z&&j<x&&(F=x,x=j,j=F),tn?Z?x+j>0^L[1]<(V(L[0]-d)<T?x:j):x<=L[1]&&L[1]<=j:nn>D^(d<=L[0]&&L[0]<=C)){var Q=En(_,(-$+A)/P);return $n(Q,R),[L,Gn(Q)]}}}function h(o,a){var u=e?n:D-n,f=0;return o<-u?f|=1:o>u&&(f|=2),a<-u?f|=4:a>u&&(f|=8),f}return Dt(l,p,s,e?[0,-n]:[-D,n-D])}function he(n,t,i,e,r,s){var l=n[0],p=n[1],g=t[0],h=t[1],o=0,a=1,u=g-l,f=h-p,c;if(c=i-l,!(!u&&c>0)){if(c/=u,u<0){if(c<o)return;c<a&&(a=c)}else if(u>0){if(c>a)return;c>o&&(o=c)}if(c=r-l,!(!u&&c<0)){if(c/=u,u<0){if(c>a)return;c>o&&(o=c)}else if(u>0){if(c<o)return;c<a&&(a=c)}if(c=e-p,!(!f&&c>0)){if(c/=f,f<0){if(c<o)return;c<a&&(a=c)}else if(f>0){if(c>a)return;c>o&&(o=c)}if(c=s-p,!(!f&&c<0)){if(c/=f,f<0){if(c>a)return;c>o&&(o=c)}else if(f>0){if(c<o)return;c<a&&(a=c)}return o>0&&(n[0]=l+o*u,n[1]=p+o*f),a<1&&(t[0]=l+a*u,t[1]=p+a*f),!0}}}}}var fn=1e9,Pn=-fn;function ge(n,t,i,e){function r(h,o){return n<=h&&h<=i&&t<=o&&o<=e}function s(h,o,a,u){var f=0,c=0;if(h==null||(f=l(h,a))!==(c=l(o,a))||g(h,o)<0^a>0)do u.point(f===0||f===3?n:i,f>1?e:t);while((f=(f+a+4)%4)!==c);else u.point(o[0],o[1])}function l(h,o){return V(h[0]-n)<T?o>0?0:3:V(h[0]-i)<T?o>0?2:1:V(h[1]-t)<T?o>0?1:0:o>0?3:2}function p(h,o){return g(h.x,o.x)}function g(h,o){var a=l(h,1),u=l(o,1);return a!==u?a-u:a===0?o[1]-h[1]:a===1?h[0]-o[0]:a===2?h[1]-o[1]:o[0]-h[0]}return function(h){var o=h,a=It(),u,f,c,S,m,N,E,w,y,M,I,R={point:k,lineStart:O,lineEnd:A,polygonStart:$,polygonEnd:P};function k(d,C){r(d,C)&&o.point(d,C)}function _(){for(var d=0,C=0,x=f.length;C<x;++C)for(var j=f[C],F=1,nn=j.length,Z=j[0],tn,Q,yn=Z[0],ln=Z[1];F<nn;++F)tn=yn,Q=ln,Z=j[F],yn=Z[0],ln=Z[1],Q<=e?ln>e&&(yn-tn)*(e-Q)>(ln-Q)*(n-tn)&&++d:ln<=e&&(yn-tn)*(e-Q)<(ln-Q)*(n-tn)&&--d;return d}function $(){o=a,u=[],f=[],I=!0}function P(){var d=_(),C=I&&d,x=(u=Pt(u)).length;(C||x)&&(h.polygonStart(),C&&(h.lineStart(),s(null,null,1,h),h.lineEnd()),x&&Ct(u,p,d,s,h),h.polygonEnd()),o=h,u=f=c=null}function O(){R.point=L,f&&f.push(c=[]),M=!0,y=!1,E=w=NaN}function A(){u&&(L(S,m),N&&y&&a.rejoin(),u.push(a.result())),R.point=k,y&&o.lineEnd()}function L(d,C){var x=r(d,C);if(f&&c.push([d,C]),M)S=d,m=C,N=x,M=!1,x&&(o.lineStart(),o.point(d,C));else if(x&&y)o.point(d,C);else{var j=[E=Math.max(Pn,Math.min(fn,E)),w=Math.max(Pn,Math.min(fn,w))],F=[d=Math.max(Pn,Math.min(fn,d)),C=Math.max(Pn,Math.min(fn,C))];he(j,F,n,t,i,e)?(y||(o.lineStart(),o.point(j[0],j[1])),o.point(F[0],F[1]),x||o.lineEnd(),I=!1):x&&(o.lineStart(),o.point(d,C),I=!1)}E=d,w=C,y=x}return R}}const On=n=>n;var zn=new en,Yn=new en,kt,_t,Xn,qn,b={point:W,lineStart:W,lineEnd:W,polygonStart:function(){b.lineStart=ve,b.lineEnd=xe},polygonEnd:function(){b.lineStart=b.lineEnd=b.point=W,zn.add(V(Yn)),Yn=new en},result:function(){var n=zn/2;return zn=new en,n}};function ve(){b.point=me}function me(n,t){b.point=Rt,kt=Xn=n,_t=qn=t}function Rt(n,t){Yn.add(qn*n-Xn*t),Xn=n,qn=t}function xe(){Rt(kt,_t)}var cn=1/0,Dn=cn,xn=-cn,kn=xn,_n={point:Se,lineStart:W,lineEnd:W,polygonStart:W,polygonEnd:W,result:function(){var n=[[cn,Dn],[xn,kn]];return xn=kn=-(Dn=cn=1/0),n}};function Se(n,t){n<cn&&(cn=n),n>xn&&(xn=n),t<Dn&&(Dn=t),t>kn&&(kn=t)}var Un=0,Wn=0,pn=0,Rn=0,Ln=0,sn=0,Zn=0,Jn=0,dn=0,Lt,$t,J,K,U={point:rn,lineStart:dt,lineEnd:ht,polygonStart:function(){U.lineStart=Ee,U.lineEnd=we},polygonEnd:function(){U.point=rn,U.lineStart=dt,U.lineEnd=ht},result:function(){var n=dn?[Zn/dn,Jn/dn]:sn?[Rn/sn,Ln/sn]:pn?[Un/pn,Wn/pn]:[NaN,NaN];return Un=Wn=pn=Rn=Ln=sn=Zn=Jn=dn=0,n}};function rn(n,t){Un+=n,Wn+=t,++pn}function dt(){U.point=ye}function ye(n,t){U.point=Ne,rn(J=n,K=t)}function Ne(n,t){var i=n-J,e=t-K,r=on(i*i+e*e);Rn+=r*(J+n)/2,Ln+=r*(K+t)/2,sn+=r,rn(J=n,K=t)}function ht(){U.point=rn}function Ee(){U.point=Pe}function we(){Tt(Lt,$t)}function Pe(n,t){U.point=Tt,rn(Lt=J=n,$t=K=t)}function Tt(n,t){var i=n-J,e=t-K,r=on(i*i+e*e);Rn+=r*(J+n)/2,Ln+=r*(K+t)/2,sn+=r,r=K*n-J*t,Zn+=r*(J+n),Jn+=r*(K+t),dn+=r*3,rn(J=n,K=t)}function zt(n){this._context=n}zt.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:{this._context.moveTo(n,t),this._point=1;break}case 1:{this._context.lineTo(n,t);break}default:{this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,q);break}}},result:W};var Kn=new en,An,At,Vt,hn,gn,Sn={point:W,lineStart:function(){Sn.point=je},lineEnd:function(){An&&Gt(At,Vt),Sn.point=W},polygonStart:function(){An=!0},polygonEnd:function(){An=null},result:function(){var n=+Kn;return Kn=new en,n}};function je(n,t){Sn.point=Gt,At=hn=n,Vt=gn=t}function Gt(n,t){hn-=n,gn-=t,Kn.add(on(hn*hn+gn*gn)),hn=n,gn=t}function Ht(){this._string=[]}Ht.prototype={_radius:4.5,_circle:gt(4.5),pointRadius:function(n){return(n=+n)!==this._radius&&(this._radius=n,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(n,t){switch(this._point){case 0:{this._string.push("M",n,",",t),this._point=1;break}case 1:{this._string.push("L",n,",",t);break}default:{this._circle==null&&(this._circle=gt(this._radius)),this._string.push("M",n,",",t,this._circle);break}}},result:function(){if(this._string.length){var n=this._string.join("");return this._string=[],n}else return null}};function gt(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Me(n,t){var i=4.5,e,r;function s(l){return l&&(typeof i=="function"&&r.pointRadius(+i.apply(this,arguments)),an(l,e(r))),r.result()}return s.area=function(l){return an(l,e(b)),b.result()},s.measure=function(l){return an(l,e(Sn)),Sn.result()},s.bounds=function(l){return an(l,e(_n)),_n.result()},s.centroid=function(l){return an(l,e(U)),U.result()},s.projection=function(l){return arguments.length?(e=l==null?(n=null,On):(n=l).stream,s):n},s.context=function(l){return arguments.length?(r=l==null?(t=null,new Ht):new zt(t=l),typeof i!="function"&&r.pointRadius(i),s):t},s.pointRadius=function(l){return arguments.length?(i=typeof l=="function"?l:(r.pointRadius(+l),+l),s):i},s.projection(n).context(t)}function bn(n){return function(t){var i=new Qn;for(var e in n)i[e]=n[e];return i.stream=t,i}}function Qn(){}Qn.prototype={constructor:Qn,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function nt(n,t,i){var e=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),e!=null&&n.clipExtent(null),an(i,n.stream(_n)),t(_n.result()),e!=null&&n.clipExtent(e),n}function Bt(n,t,i){return nt(n,function(e){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],l=Math.min(r/(e[1][0]-e[0][0]),s/(e[1][1]-e[0][1])),p=+t[0][0]+(r-l*(e[1][0]+e[0][0]))/2,g=+t[0][1]+(s-l*(e[1][1]+e[0][1]))/2;n.scale(150*l).translate([p,g])},i)}function Ie(n,t,i){return Bt(n,[[0,0],t],i)}function Ce(n,t,i){return nt(n,function(e){var r=+t,s=r/(e[1][0]-e[0][0]),l=(r-s*(e[1][0]+e[0][0]))/2,p=-s*e[0][1];n.scale(150*s).translate([l,p])},i)}function De(n,t,i){return nt(n,function(e){var r=+t,s=r/(e[1][1]-e[0][1]),l=-s*e[0][0],p=(r-s*(e[1][1]+e[0][1]))/2;n.scale(150*s).translate([l,p])},i)}var vt=16,ke=G(30*B);function mt(n,t){return+t?Re(n,t):_e(n)}function _e(n){return bn({point:function(t,i){t=n(t,i),this.stream.point(t[0],t[1])}})}function Re(n,t){function i(e,r,s,l,p,g,h,o,a,u,f,c,S,m){var N=h-e,E=o-r,w=N*N+E*E;if(w>4*t&&S--){var y=l+u,M=p+f,I=g+c,R=on(y*y+M*M+I*I),k=mn(I/=R),_=V(V(I)-1)<T||V(s-a)<T?(s+a)/2:vn(M,y),$=n(_,k),P=$[0],O=$[1],A=P-e,L=O-r,d=E*A-N*L;(d*d/w>t||V((N*A+E*L)/w-.5)>.3||l*u+p*f+g*c<ke)&&(i(e,r,s,l,p,g,P,O,_,y/=R,M/=R,I,S,m),m.point(P,O),i(P,O,_,y,M,I,h,o,a,u,f,c,S,m))}}return function(e){var r,s,l,p,g,h,o,a,u,f,c,S,m={point:N,lineStart:E,lineEnd:y,polygonStart:function(){e.polygonStart(),m.lineStart=M},polygonEnd:function(){e.polygonEnd(),m.lineStart=E}};function N(k,_){k=n(k,_),e.point(k[0],k[1])}function E(){a=NaN,m.point=w,e.lineStart()}function w(k,_){var $=un([k,_]),P=n(k,_);i(a,u,o,f,c,S,a=P[0],u=P[1],o=k,f=$[0],c=$[1],S=$[2],vt,e),e.point(a,u)}function y(){m.point=N,e.lineEnd()}function M(){E(),m.point=I,m.lineEnd=R}function I(k,_){w(r=k,_),s=a,l=u,p=f,g=c,h=S,m.point=w}function R(){i(a,u,o,f,c,S,s,l,r,p,g,h,vt,e),m.lineEnd=y,y()}return m}}var Le=bn({point:function(n,t){this.stream.point(n*B,t*B)}});function $e(n){return bn({point:function(t,i){var e=n(t,i);return this.stream.point(e[0],e[1])}})}function Te(n,t,i,e,r){function s(l,p){return l*=e,p*=r,[t+n*l,i-n*p]}return s.invert=function(l,p){return[(l-t)/n*e,(i-p)/n*r]},s}function xt(n,t,i,e,r,s){if(!s)return Te(n,t,i,e,r);var l=G(s),p=H(s),g=l*n,h=p*n,o=l/n,a=p/n,u=(p*i-l*t)/n,f=(p*t+l*i)/n;function c(S,m){return S*=e,m*=r,[g*S-h*m+t,i-h*S-g*m]}return c.invert=function(S,m){return[e*(o*S-a*m+u),r*(f-a*S-o*m)]},c}function ze(n){return Ae(function(){return n})()}function Ae(n){var t,i=150,e=480,r=250,s=0,l=0,p=0,g=0,h=0,o,a=0,u=1,f=1,c=null,S=pt,m=null,N,E,w,y=On,M=.5,I,R,k,_,$;function P(d){return k(d[0]*B,d[1]*B)}function O(d){return d=k.invert(d[0],d[1]),d&&[d[0]*X,d[1]*X]}P.stream=function(d){return _&&$===d?_:_=Le($e(o)(S(I(y($=d)))))},P.preclip=function(d){return arguments.length?(S=d,c=void 0,L()):S},P.postclip=function(d){return arguments.length?(y=d,m=N=E=w=null,L()):y},P.clipAngle=function(d){return arguments.length?(S=+d?de(c=d*B):(c=null,pt),L()):c*X},P.clipExtent=function(d){return arguments.length?(y=d==null?(m=N=E=w=null,On):ge(m=+d[0][0],N=+d[0][1],E=+d[1][0],w=+d[1][1]),L()):m==null?null:[[m,N],[E,w]]},P.scale=function(d){return arguments.length?(i=+d,A()):i},P.translate=function(d){return arguments.length?(e=+d[0],r=+d[1],A()):[e,r]},P.center=function(d){return arguments.length?(s=d[0]%360*B,l=d[1]%360*B,A()):[s*X,l*X]},P.rotate=function(d){return arguments.length?(p=d[0]%360*B,g=d[1]%360*B,h=d.length>2?d[2]%360*B:0,A()):[p*X,g*X,h*X]},P.angle=function(d){return arguments.length?(a=d%360*B,A()):a*X},P.reflectX=function(d){return arguments.length?(u=d?-1:1,A()):u<0},P.reflectY=function(d){return arguments.length?(f=d?-1:1,A()):f<0},P.precision=function(d){return arguments.length?(I=mt(R,M=d*d),L()):on(M)},P.fitExtent=function(d,C){return Bt(P,d,C)},P.fitSize=function(d,C){return Ie(P,d,C)},P.fitWidth=function(d,C){return Ce(P,d,C)},P.fitHeight=function(d,C){return De(P,d,C)};function A(){var d=xt(i,0,0,u,f,a).apply(null,t(s,l)),C=xt(i,e-d[0],r-d[1],u,f,a);return o=Mt(p,g,h),R=Bn(t,C),k=Bn(o,R),I=mt(R,M),L()}function L(){return _=$=null,P}return function(){return t=n.apply(this,arguments),P.invert=t.invert&&O,A()}}function tt(n,t){return[n,te(ie((Y+t)/2))]}tt.invert=function(n,t){return[n,2*jt(ne(t))-Y]};function Ve(){return Ge(tt).scale(961/q)}function Ge(n){var t=ze(n),i=t.center,e=t.scale,r=t.translate,s=t.clipExtent,l=null,p,g,h;t.scale=function(a){return arguments.length?(e(a),o()):e()},t.translate=function(a){return arguments.length?(r(a),o()):r()},t.center=function(a){return arguments.length?(i(a),o()):i()},t.clipExtent=function(a){return arguments.length?(a==null?l=p=g=h=null:(l=+a[0][0],p=+a[0][1],g=+a[1][0],h=+a[1][1]),o()):l==null?null:[[l,p],[g,h]]};function o(){var a=D*e(),u=t(oe(t.rotate()).invert([0,0]));return s(l==null?[[u[0]-a,u[1]-a],[u[0]+a,u[1]+a]]:n===tt?[[Math.max(u[0]-a,l),p],[Math.min(u[0]+a,g),h]]:[[l,Math.max(u[1]-a,p)],[g,Math.min(u[1]+a,h)]])}return o()}const He="/bangladesh-districts.geojson",St=400,yt=550;function Be(n){const t=n.geometry,i=e=>e.map(r=>r.slice().reverse());return t.type==="Polygon"?{...n,geometry:{...t,coordinates:i(t.coordinates)}}:t.type==="MultiPolygon"?{...n,geometry:{...t,coordinates:t.coordinates.map(i)}}:n}function Fe({districtData:n,selectedDistrictId:t,onDistrictClick:i,onDistrictHover:e,onDistrictLeave:r,isDark:s}){const[l,p]=z.useState(null);z.useEffect(()=>{fetch(He).then(c=>c.json()).then(c=>({...c,features:c.features.map(Be)})).then(p)},[]);const g=z.useMemo(()=>{const c={};for(const S of n)c[S.name]=S;return c},[n]),{projection:h,pathGenerator:o}=z.useMemo(()=>{if(!l)return{};const c=Ve().fitSize([St,yt],l),S=Me().projection(c);return{projection:c,pathGenerator:S}},[l]),a=s?"#5a6e5a":"#8a9a8a",u=s?"#475b47":"#b0bdb0",f=z.useCallback((c,S)=>{S&&e(S,{x:c.clientX,y:c.clientY})},[e]);return!l||!o?v.jsx("div",{className:"flex items-center justify-center",style:{height:400},children:v.jsx("div",{className:"animate-pulse-slow text-olive-400 dark:text-sage-500 text-sm",children:"Loading map..."})}):v.jsx("svg",{viewBox:`0 0 ${St} ${yt}`,className:"w-full h-auto",role:"img","aria-label":"District map of Bangladesh",children:l.features.map((c,S)=>{const m=c.properties.ADM2_EN,N=g[m],E=N&&N.leadingPartyId,w=N&&t===N.districtId,y=t&&(!N||t!==N.districtId),M=E?N.leadingPartyColor:u,I=o(c);return I?v.jsx("path",{d:I,fill:M,stroke:a,strokeWidth:w?3:1,opacity:y?.35:1,cursor:N?"pointer":"default",style:{transition:"opacity 0.3s ease, fill 0.3s ease"},onMouseMove:N?R=>f(R,N):void 0,onMouseLeave:N?r:void 0,onClick:N?()=>i(N.districtId):void 0},`district-${S}`):null})})}function Oe({district:n,position:t}){return n?v.jsx("div",{className:"fixed z-50 pointer-events-none animate-fade-in",style:{left:t.x+12,top:t.y-8},children:v.jsxs(Mn,{variant:"elevated",padding:"sm",className:"min-w-[200px] shadow-soft-lg",children:[v.jsx("p",{className:"font-display font-semibold text-sm text-olive-900 dark:text-sage-100 mb-1.5",children:n.name}),v.jsxs("div",{className:"space-y-1.5 text-xs text-olive-600 dark:text-sage-300",children:[v.jsxs("p",{className:"flex items-center gap-1.5",children:[v.jsx("span",{className:"text-olive-400 dark:text-sage-500",children:"Leading: "}),v.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0 inline-block",style:{backgroundColor:n.leadingPartyColor}}),n.leadingPartyName]}),v.jsxs("p",{children:[v.jsx("span",{className:"text-olive-400 dark:text-sage-500",children:"Seats: "}),n.seatBreakdown||`${n.seatCount} total`]}),v.jsxs("p",{children:[v.jsx("span",{className:"text-olive-400 dark:text-sage-500",children:"Votes: "}),Et(n.totalVotes)]}),v.jsxs("div",{children:[v.jsxs("span",{className:"text-olive-400 dark:text-sage-500",children:["Completed:"," "]}),wt(n.completionPercent,0),v.jsx("div",{className:"mt-1 w-full h-1.5 bg-sage-200 dark:bg-sage-700 rounded-full overflow-hidden",children:v.jsx("div",{className:"h-full bg-green-500 rounded-full transition-all duration-500",style:{width:`${n.completionPercent}%`}})})]})]})]})}):null}const Ye=[["div-7","div-8","div-6"],["div-3","div-1","div-2"],["div-4","div-5",null]];function Xe({seat:n,position:t}){return n?v.jsx("div",{className:"fixed z-50 pointer-events-none animate-fade-in",style:{left:t.x+12,top:t.y-8},children:v.jsxs(Mn,{variant:"elevated",padding:"sm",className:"min-w-[180px] shadow-soft-lg",children:[v.jsx("p",{className:"font-display font-semibold text-sm text-olive-900 dark:text-sage-100 mb-1",children:n.name}),v.jsxs("div",{className:"space-y-1 text-xs text-olive-600 dark:text-sage-300",children:[v.jsxs("p",{children:[v.jsxs("span",{className:"text-olive-400 dark:text-sage-500",children:["Leading:"," "]}),n.leadingPartyName]}),v.jsxs("p",{children:[v.jsx("span",{className:"text-olive-400 dark:text-sage-500",children:"Votes: "}),Et(n.totalVotes)]}),v.jsxs("p",{children:[v.jsxs("span",{className:"text-olive-400 dark:text-sage-500",children:["Completed:"," "]}),wt(n.completionPercent,0)]})]})]})}):null}function qe({seat:n,index:t,onHover:i,onLeave:e,onClick:r}){const s=z.useCallback(g=>{i(n,{x:g.clientX,y:g.clientY})},[n,i]),l=!n.leadingPartyId||n.totalVotes===0,p=l?"#D1D5DB":n.leadingPartyColor;return v.jsx("button",{onClick:()=>r(n.seatId),onMouseEnter:s,onMouseLeave:e,className:Ft("w-12 h-12 sm:w-14 sm:h-14 rounded-lg transition-all duration-300 cursor-pointer","hover:scale-110 hover:shadow-soft-lg hover:z-10","focus:outline-none focus:ring-2 focus:ring-green-500/50","animate-scale-in"),style:{backgroundColor:p,animationDelay:`${t*20}ms`,opacity:l?.5:.85+n.completionPercent/100*.15},title:n.name,"aria-label":`${n.name} - ${n.leadingPartyName}`,children:v.jsx("span",{className:"text-white/90 text-[10px] font-semibold drop-shadow-sm",children:n.seatNumber})})}function Nt({divisionName:n,seats:t,startIndex:i,onHover:e,onLeave:r,onClick:s}){return t.length===0?null:v.jsxs("div",{className:"flex flex-col items-center",children:[v.jsx("h3",{className:"font-display text-xs font-semibold text-olive-500 dark:text-sage-400 mb-2 uppercase tracking-wider",children:n}),v.jsx("div",{className:"flex flex-wrap gap-1.5 justify-center max-w-[200px]",children:t.map((l,p)=>v.jsx(qe,{seat:l,index:i+p,onHover:e,onLeave:r,onClick:s},l.seatId))})]})}function oi(){const n=Ot(),{mapData:t,lastUpdated:i,isLoading:e}=Kt(),[r,s]=z.useState(""),[l,p]=z.useState(null),[g,h]=z.useState({x:0,y:0}),[o,a]=z.useState(null),[u,f]=z.useState(null),[c,S]=z.useState({x:0,y:0}),m=Qt(t),[N,E]=z.useState(()=>window.matchMedia("(prefers-color-scheme: dark)").matches);z.useEffect(()=>{const x=window.matchMedia("(prefers-color-scheme: dark)"),j=F=>E(F.matches);return x.addEventListener("change",j),()=>x.removeEventListener("change",j)},[]);const w=Wt(),y=[{value:"",label:"All Divisions"},...w.map(x=>({value:x.id,label:x.name}))],M=z.useMemo(()=>{if(!t)return[];let x=t;return r&&(x=x.filter(j=>j.divisionId===r)),o&&(x=x.filter(j=>j.districtId===o)),x},[t,r,o]),I=z.useMemo(()=>{const x={};for(const j of M)x[j.divisionId]||(x[j.divisionId]=[]),x[j.divisionId].push(j);return x},[M]),R=z.useMemo(()=>{if(!t||t.length===0)return[];const x=new Map;for(const j of t)j.leadingPartyId&&!x.has(j.leadingPartyId)&&x.set(j.leadingPartyId,{id:j.leadingPartyId,name:j.leadingPartyName,color:j.leadingPartyColor});return Array.from(x.values())},[t]),k=z.useMemo(()=>{const x={};for(const j of w)x[j.id]=j.name;return x},[w]);function _(x,j){p(x),h(j)}function $(){p(null)}function P(x){n(`/seats/${x}`)}const O=z.useCallback(x=>{a(j=>j===x?null:x)},[]),A=z.useCallback((x,j)=>{f(x),S(j)},[]),L=z.useCallback(()=>{f(null)},[]);if(e&&t.length===0)return v.jsxs("div",{className:"space-y-6",children:[v.jsx(et,{className:"h-10 w-64 rounded-xl"}),v.jsx(et,{className:"h-[500px] w-full rounded-2xl"})]});const d=o?m.find(x=>x.districtId===o)?.name:null;let C=0;return v.jsxs("div",{className:"space-y-6 animate-fade-in",children:[v.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[v.jsx("h1",{className:"font-display text-2xl font-bold text-olive-900 dark:text-sage-50",children:"Constituency Map"}),v.jsx("div",{className:"w-full sm:w-48",children:v.jsx(Zt,{options:y,value:r,onChange:x=>s(x.target.value),size:"sm"})})]}),v.jsxs("div",{className:"flex flex-wrap gap-3",children:[R.map(x=>v.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[v.jsx("span",{className:"w-3 h-3 rounded-full shrink-0",style:{backgroundColor:x.color}}),v.jsx("span",{className:"text-olive-600 dark:text-sage-300",children:x.name})]},x.id)),v.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[v.jsx("span",{className:"w-3 h-3 rounded-full shrink-0 bg-gray-300"}),v.jsx("span",{className:"text-olive-600 dark:text-sage-300",children:"No Data"})]})]}),v.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[v.jsxs(Mn,{padding:"lg",className:"overflow-hidden",children:[v.jsx("h2",{className:"font-display text-sm font-semibold text-olive-700 dark:text-sage-200 mb-4 uppercase tracking-wider",children:"District Map"}),v.jsx(Fe,{districtData:m,selectedDistrictId:o,onDistrictClick:O,onDistrictHover:A,onDistrictLeave:L,isDark:N})]}),v.jsxs(Mn,{padding:"lg",className:"overflow-hidden",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h2",{className:"font-display text-sm font-semibold text-olive-700 dark:text-sage-200 uppercase tracking-wider",children:"Constituency Grid"}),d&&v.jsxs("button",{onClick:()=>a(null),className:"text-xs text-green-600 dark:text-green-400 hover:underline",children:["Showing ",d," — Clear filter"]})]}),r?v.jsx("div",{className:"flex justify-center py-8",children:v.jsx(Nt,{divisionName:k[r]||"",seats:I[r]||[],startIndex:0,onHover:_,onLeave:$,onClick:P})}):v.jsx("div",{className:"flex flex-col items-center gap-8 py-6",children:Ye.map((x,j)=>v.jsx("div",{className:"flex items-start justify-center gap-6 sm:gap-10 flex-wrap",children:x.map(F=>{if(!F)return null;const nn=I[F]||[],Z=C;return C+=nn.length,v.jsx(Nt,{divisionName:k[F]||"",seats:nn,startIndex:Z,onHover:_,onLeave:$,onClick:P},F)})},j))})]})]}),v.jsx(Xe,{seat:l,position:g}),v.jsx(Oe,{district:u,position:c}),v.jsx("div",{className:"flex justify-center pt-2",children:v.jsx(Jt,{lastUpdated:i})})]})}export{oi as default};
