import{d as m,e as h,h as p,i as L,j as y,k as D,l as w}from"./formatters-DXobJT5u.js";import{c as v}from"./vendor-state-CPk78qbZ.js";import{r}from"./vendor-react-D5zly3OG.js";function s(){const a=300+Math.floor(Math.random()*200);return new Promise(e=>setTimeout(e,a))}const b=v(a=>({overview:null,adminDashboard:null,seats:[],seatsPagination:{page:1,totalPages:1,total:0},seatDetail:null,seatCentres:null,parties:[],mapData:[],lastUpdated:null,isLoading:!1,error:null,setOverview:e=>a({overview:e}),setSeats:e=>a({seats:e}),setSeatsPagination:e=>a({seatsPagination:e}),setSeatDetail:e=>a({seatDetail:e}),setSeatCentres:e=>a({seatCentres:e}),setParties:e=>a({parties:e}),setMapData:e=>a({mapData:e}),setLastUpdated:e=>a({lastUpdated:e}),setIsLoading:e=>a({isLoading:e}),setError:e=>a({error:e}),fetchOverview:async()=>{a({isLoading:!0,error:null});try{await s();const e=w();a({overview:e,lastUpdated:new Date,isLoading:!1})}catch(e){a({error:e.message,isLoading:!1})}},fetchSeats:async e=>{a({isLoading:!0,error:null});try{await s();const t=D(e);a({seats:t.seats,seatsPagination:{page:t.page,totalPages:t.totalPages,total:t.total},lastUpdated:new Date,isLoading:!1})}catch(t){a({error:t.message,isLoading:!1})}},fetchSeatDetail:async e=>{a({isLoading:!0,error:null});try{await s();const t=y(e);a({seatDetail:t,lastUpdated:new Date,isLoading:!1})}catch(t){a({error:t.message,isLoading:!1})}},fetchSeatCentres:async e=>{a({isLoading:!0,error:null});try{await s();const t=L(e);a({seatCentres:t,lastUpdated:new Date,isLoading:!1})}catch(t){a({error:t.message,isLoading:!1})}},fetchParties:async()=>{a({isLoading:!0,error:null});try{await s();const e=p();a({parties:e,lastUpdated:new Date,isLoading:!1})}catch(e){a({error:e.message,isLoading:!1})}},fetchMapData:async()=>{a({isLoading:!0,error:null});try{await s();const e=h();a({mapData:e,lastUpdated:new Date,isLoading:!1})}catch(e){a({error:e.message,isLoading:!1})}},fetchAdminDashboard:async()=>{a({isLoading:!0,error:null});try{await s();const e=m();a({adminDashboard:e,lastUpdated:new Date,isLoading:!1})}catch(e){a({error:e.message,isLoading:!1})}}}));function U(a,{interval:e=3e4,enabled:t=!0,onError:c}={}){const o=r.useRef(null),u=r.useRef(!1),n=r.useRef(0),d=r.useRef(!0),i=r.useCallback(async()=>{if(!(u.current||!d.current)){u.current=!0;try{await a(),n.current=0}catch(l){n.current++,n.current>=3&&c&&c(l)}finally{u.current=!1}}},[a,c]);return r.useEffect(()=>(d.current=!0,i(),()=>{d.current=!1}),[i]),r.useEffect(()=>{if(!t){clearInterval(o.current);return}const l=()=>n.current===0?e:Math.min(e*Math.pow(2,n.current),12e4),f=()=>{i(),clearInterval(o.current),o.current=setInterval(f,l())};o.current=setInterval(f,l());const g=()=>{document.visibilityState==="visible"&&i()};return document.addEventListener("visibilitychange",g),()=>{clearInterval(o.current),document.removeEventListener("visibilitychange",g)}},[t,e,i]),{refresh:i,errorCount:n.current}}export{U as a,b as u};
