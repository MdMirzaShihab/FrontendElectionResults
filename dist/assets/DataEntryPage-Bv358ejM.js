import{j as e,c as u,u as X,S as q}from"./index-C_gzxXLR.js";import{r as l,b as F}from"./vendor-react-D5zly3OG.js";import{k as G,j as J,i as Q,f as j}from"./formatters-DXobJT5u.js";import{B as b}from"./Button-CcyT1Mks.js";import{C as N,a as y,b as S,c as w}from"./Card-Ce4z5HAh.js";import{S as Y}from"./Select-COX7ggO_.js";import{B as z}from"./Badge-CX70jgsv.js";import{P as Z}from"./ProgressBar-QGnkt7qF.js";import{X as I,r as _,B as ee,n as te,t as se,j as ae}from"./vendor-icons-B72874lV.js";import"./vendor-charts-CASEHI2m.js";import"./vendor-state-CPk78qbZ.js";const re={sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl","3xl":"max-w-3xl",full:"max-w-[95vw]"};function M({isOpen:o,onClose:r,title:n,description:s,size:m="md",closeOnEscape:x=!0,closeOnOverlayClick:f=!0,children:i}){const d=l.useCallback(c=>{c.key==="Escape"&&x&&r()},[r,x]);if(l.useEffect(()=>{if(o)return document.addEventListener("keydown",d),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",d),document.body.style.overflow=""}},[o,d]),!o)return null;function g(c){c.target===c.currentTarget&&f&&r()}return F.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":n?"modal-title":void 0,children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm animate-fade-in",onClick:g,"aria-hidden":"true"}),e.jsxs("div",{className:u("relative z-10 w-full rounded-2xl","bg-white dark:bg-gradient-to-br dark:from-[#1e2822] dark:to-[#161f1a]","border border-sage-200 dark:border-sage-800","shadow-soft-xl animate-scale-in","max-h-[90vh] flex flex-col",re[m]),children:[(n||s)&&e.jsxs("div",{className:"flex items-start justify-between gap-4 p-5 pb-0",children:[e.jsxs("div",{children:[n&&e.jsx("h2",{id:"modal-title",className:"font-display font-semibold text-lg text-olive-900 dark:text-sage-100",children:n}),s&&e.jsx("p",{className:"mt-1 text-sm text-olive-500 dark:text-sage-400",children:s})]}),e.jsx("button",{onClick:r,className:u("shrink-0 p-1.5 rounded-lg transition-all duration-200","text-olive-400 hover:text-olive-700 hover:bg-sage-100","dark:text-sage-500 dark:hover:text-sage-200 dark:hover:bg-sage-800"),"aria-label":"Close modal",children:e.jsx(I,{size:18})})]}),!n&&!s&&e.jsx("button",{onClick:r,className:u("absolute top-3 right-3 z-10 p-1.5 rounded-lg transition-all duration-200","text-olive-400 hover:text-olive-700 hover:bg-sage-100","dark:text-sage-500 dark:hover:text-sage-200 dark:hover:bg-sage-800"),"aria-label":"Close modal",children:e.jsx(I,{size:18})}),e.jsx("div",{className:"p-5 overflow-y-auto",children:i})]})]}),document.body)}M.displayName="Modal";function B({isOpen:o,title:r="Confirm action",message:n,confirmText:s="Confirm",cancelText:m="Cancel",onConfirm:x,onCancel:f,variant:i="primary",loading:d=!1}){const g=i==="danger"?"danger":"primary";return e.jsxs(M,{isOpen:o,onClose:f,title:r,size:"sm",children:[n&&e.jsx("p",{className:"text-sm text-olive-600 dark:text-sage-300",children:n}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-5",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:f,disabled:d,children:m}),e.jsx(b,{variant:g,size:"sm",onClick:x,loading:d,children:d?"Processing...":s})]})]})}B.displayName="ConfirmModal";function ne({currentStep:o}){const r=[{key:1,label:"Select Seat"},{key:2,label:"Select Centre"},{key:3,label:"Enter Votes"}];return e.jsx("div",{className:"flex items-center gap-2 mb-6",children:r.map((n,s)=>{const m=n.key===o,x=n.key<o;return e.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&e.jsx(ae,{size:14,className:"text-olive-300 dark:text-sage-600"}),e.jsx("span",{className:u("text-sm font-medium",m&&"text-green-600 dark:text-green-400",x&&"text-olive-500 dark:text-sage-400",!m&&!x&&"text-olive-300 dark:text-sage-600"),children:n.label})]},n.key)})})}function ve(){const{showSuccess:o}=X(),[r,n]=l.useState(""),[s,m]=l.useState(null),[x,f]=l.useState([]),[i,d]=l.useState(null),[g,c]=l.useState({}),[P,E]=l.useState(!1),[D,k]=l.useState(!1),[T,$]=l.useState(new Set),R=l.useMemo(()=>G({page:1,limit:100}).seats,[]),L=l.useMemo(()=>R.map(t=>{const a=t.totalCentres>0?Math.round(t.reportedCentreCount/t.totalCentres*100):0;return{value:t.id,label:`${t.seatNumber}. ${t.name} — ${a}% reported`}}),[R]);l.useEffect(()=>{if(!r)return;E(!0),m(null),f([]),d(null),c({});const t=J(r),a=Q(r);m(t),f(a),E(!1)},[r]);function A(t){d(t);const a={};if(s?.candidates)for(const v of s.candidates){const p=t.results.find(W=>W.candidateId===v.id);a[v.id]=p?p.votes:0}c(a)}function O(t,a){const v=Math.max(0,parseInt(a,10)||0);c(p=>({...p,[t]:v}))}const h=l.useMemo(()=>Object.values(g).reduce((t,a)=>t+a,0),[g]),V=i&&h>i.registeredVoters;function H(){k(!0)}function K(){k(!1),$(t=>new Set([...t,i.id])),o(`Results saved successfully for ${i.name}`),d(null),c({})}function U(){return i?3:r&&s?2:1}const C=U();return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"font-display font-bold text-xl text-olive-900 dark:text-sage-100",children:"Data Entry"})}),e.jsx(ne,{currentStep:C}),e.jsxs(N,{variant:"default",padding:"md",children:[e.jsx(y,{children:e.jsx(S,{className:"text-base",children:"Select Constituency"})}),e.jsx(w,{children:e.jsx(Y,{placeholder:"Choose a seat...",options:L,value:r,onChange:t=>n(t.target.value)})})]}),P&&e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(q,{size:"lg"})}),C>=2&&s&&!i&&e.jsxs(N,{variant:"default",padding:"none",children:[e.jsxs(y,{className:"px-5 pt-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-base",children:s.name}),e.jsxs("p",{className:"text-sm text-olive-500 dark:text-sage-400 mt-0.5",children:["Seat #",s.seatNumber," · ",s.divisionName]})]}),e.jsxs(z,{variant:s.status==="completed"?"success":"default",size:"sm",children:[s.reportedCentreCount,"/",s.totalCentres," centres"]})]}),e.jsx(Z,{value:s.reportedCentreCount,max:s.totalCentres,size:"sm",className:"mt-3"})]}),e.jsx(w,{children:e.jsx("div",{className:"divide-y divide-sage-100 dark:divide-sage-800",children:x.map(t=>{const a=t.isReported||T.has(t.id);return e.jsxs("button",{onClick:()=>!a&&A(t),disabled:a,className:u("w-full flex items-center justify-between px-5 py-3 text-left transition-colors",a?"opacity-60 cursor-not-allowed":"hover:bg-sage-50 dark:hover:bg-sage-900 cursor-pointer"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:u("w-8 h-8 rounded-lg flex items-center justify-center shrink-0",a?"bg-green-50 dark:bg-green-950":"bg-sage-100 dark:bg-sage-800"),children:a?e.jsx(_,{size:14,className:"text-green-600 dark:text-green-400"}):e.jsx(ee,{size:14,className:"text-olive-400 dark:text-sage-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-olive-800 dark:text-sage-200",children:t.name}),e.jsxs("p",{className:"text-xs text-olive-400 dark:text-sage-500",children:[j(t.registeredVoters)," registered voters"]})]})]}),e.jsx(z,{variant:a?"success":"default",size:"sm",dot:!0,children:a?"Reported":"Pending"})]},t.id)})})})]}),C===3&&i&&s&&e.jsxs(N,{variant:"default",padding:"none",children:[e.jsx(y,{className:"px-5 pt-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-base",children:"Enter Results"}),e.jsx("p",{className:"text-sm text-olive-500 dark:text-sage-400 mt-0.5",children:i.name})]}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>{d(null),c({})},children:"Back"})]})}),e.jsxs(w,{className:"px-5 pb-5",children:[e.jsx("div",{className:"space-y-3",children:s.candidates.map(t=>e.jsxs("div",{className:"flex items-center gap-3 py-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-olive-800 dark:text-sage-200 truncate",children:t.name}),e.jsx(z,{size:"sm",color:t.partyColor,className:"mt-0.5",children:t.partyAbbreviation})]}),e.jsx("input",{type:"number",min:0,value:g[t.id]||0,onChange:a=>O(t.id,a.target.value),className:u("w-28 px-3 py-2 text-sm text-right rounded-xl","bg-sage-50 border border-sage-200 text-olive-800","focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500","dark:bg-sage-900 dark:border-sage-700 dark:text-sage-100","dark:focus:border-green-400 dark:focus:ring-green-400/50")})]},t.id))}),e.jsxs("div",{className:u("mt-4 pt-4 border-t border-sage-200 dark:border-sage-800","flex items-center justify-between"),children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium text-olive-700 dark:text-sage-300",children:["Total Votes: ",j(h)]}),e.jsxs("span",{className:"text-xs text-olive-400 dark:text-sage-500 ml-2",children:["/ ",j(i.registeredVoters)," registered"]})]}),V&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-600 dark:text-red-400",children:[e.jsx(te,{size:12}),e.jsx("span",{children:"Exceeds registered voters"})]})]}),e.jsx(b,{fullWidth:!0,className:"mt-4",leftIcon:se,onClick:H,disabled:h===0||V,children:"Save Results"})]})]}),e.jsx(B,{isOpen:D,title:"Confirm Submission",message:`Confirm submission of results for ${i?.name}? Total votes: ${j(h)}.`,confirmText:"Submit Results",cancelText:"Cancel",onConfirm:K,onCancel:()=>k(!1)})]})}export{ve as default};
